generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl"]
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URI")
}

model Article {
  id          String   @id @default(uuid())
  title       String
  slug        String   @unique
  description String
  tags        String[] @default([])

  contentJson Json   @map("content_json")
  contentHtml String @map("content_html")
  contentText String @map("content_text")

  coverImage  String?   @map("cover_image")
  published   Boolean   @default(false)
  publishedAt DateTime? @map("published_at")

  readingTime Int @default(0) @map("reading_time")
  wordCount   Int @default(0) @map("word_count")

  views Int @default(0)
  likes Int @default(0)

  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  // üîó –ê–≤—Ç–æ—Ä —Å—Ç–∞—Ç—å–∏
  author   User   @relation(fields: [authorId], references: [id])
  authorId String @map("author_id")

  // üîó –ö–∞—Ç–µ–≥–æ—Ä–∏—è
  category   Category? @relation(fields: [categoryId], references: [id])
  categoryId String?   @map("category_id")

  // üîó –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
  comments Comment[]

  @@index([tags], type: Gin)
  @@index([slug])
  @@index([publishedAt])
  @@index([authorId])
  @@map("articles")
}

model User {
  id        String  @id @default(uuid())
  username  String  @unique
  email     String  @unique
  firstName String   @map("first_name")
  lastName  String? @map("last_name")

  role          UserRole @default(USER)
  passwordHash  String?  @map("password_hash")
  emailVerified  Boolean  @default(false) @map("email_verified")

  isTwoFactorEnabled Boolean    @default(false) @map("is_two_factor_enabled")
  method             AuthMethod @default(CREDENTIALS)
  accounts           Account[]

  avatar    String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // üîó –°–≤—è–∑–∏
  articles Article[]
  comments Comment[]

  @@map("users")
}

model Token {
  id        String    @id @default(uuid())
  email     String
  token     String    @unique
  type      TokenType
  expiresAt DateTime  @map("expires_at")
  createdAt DateTime  @default(now()) @map("created_at")

  @@map("tokens")
}

model Account {
  id       String @id @default(uuid())
  userId   String @map("user_id")
  type     String
  provider String

  refreshToken String? @map("refresh_token")
  accessToken  String? @map("access_token")
  expiresAt    DateTime? @map("expires_at")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  tokenType    String? @map("token_type")
  scope         String?
  idToken      String? @map("id_token")
  sessionState String? @map("session_state")

  user User @relation(fields: [userId], references: [id])

  @@unique([provider])
  @@index([userId])
  @@map("accounts")
}

model Category {
  id       String    @id @default(uuid())
  name     String    @unique
  slug     String    @unique
  articles Article[]

  @@map("categories")
}

model Comment {
  id      String @id @default(uuid())
  content String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // üîó –°–≤—è–∑—å —Å –∞–≤—Ç–æ—Ä–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
  author   User   @relation(fields: [authorId], references: [id])
  authorId String @map("author_id")

  // üîó –°–≤—è–∑—å —Å —Å—Ç–∞—Ç—å—ë–π
  article   Article @relation(fields: [articleId], references: [id])
  articleId String @map("article_id")

  @@index([articleId])
  @@index([authorId])
  @@map("comments")
}

enum TokenType {
  VERIFICATION
  TWO_FACTOR
  PASSWORD_RESET
}

enum UserRole {
  USER
  ADMIN
}

enum AuthMethod {
  CREDENTIALS
  GOOGLE
  GITHUB
}
